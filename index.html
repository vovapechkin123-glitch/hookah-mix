<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>THE MENU</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root { color-scheme: dark; }
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background: radial-gradient(1200px 800px at 30% 20%, #2b2b38 0%, #0b0b12 55%, #05050a 100%);
  color:#fff;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
}
.card{
  width:min(600px,100%);
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px;
  padding:22px;
  backdrop-filter: blur(10px);
  box-shadow:0 20px 60px rgba(0,0,0,.45);
}
.screen{display:none}
.screen.active{display:block}
h1{margin:0 0 12px;font-size:24px}
p{opacity:.85;line-height:1.5;margin:0 0 10px}
.btn{
  width:100%;
  margin-top:16px;
  padding:14px;
  border-radius:14px;
  border:0;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(90deg,#ff7a18,#ff3d77);
  color:#fff;
}
.option{
  padding:14px;
  border-radius:14px;
  background:rgba(255,255,255,.08);
  margin-top:10px;
  cursor:pointer;
}
.option:hover{background:rgba(255,255,255,.14)}
.small{font-size:13px;opacity:.7}
.timer{font-size:30px;text-align:center;margin:14px 0}
.order{
  background:rgba(255,255,255,.08);
  border-radius:14px;
  padding:14px;
  margin-top:12px;
}
.row{display:flex;justify-content:space-between;gap:12px}
.badge{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.12);
}
hr{border:0;border-top:1px solid rgba(255,255,255,.12);margin:12px 0}
</style>
</head>

<body>
<div class="card">

  <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
  <div class="screen" id="s0">
    <h1>–ü—Ä–µ–∂–¥–µ —á–µ–º –º—ã –Ω–∞—á–Ω—ë–º.</h1>
    <p>
      –ó–¥–µ—Å—å –Ω–µ –≤—ã–±–∏—Ä–∞—é—Ç –≤–∫—É—Å.<br><br>
      –ó–¥–µ—Å—å —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –º–æ–º–µ–Ω—Ç.<br><br>
      –¢–æ, —á—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ,<br>
      –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ.
    </p>
    <button class="btn" onclick="go('q1')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>

  <!-- –í–û–ü–†–û–°–´ -->
  <div class="screen" id="q1">
    <h1>–¶–≤–µ—Ç.</h1>
    <div class="option" onclick="pick(1,'–°–∏–Ω–∏–π')">üîµ –°–∏–Ω–∏–π</div>
    <div class="option" onclick="pick(1,'–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π')">üü§ –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π</div>
    <div class="option" onclick="pick(1,'–ó–µ–ª—ë–Ω—ã–π')">üü¢ –ó–µ–ª—ë–Ω—ã–π</div>
  </div>

  <div class="screen" id="q2">
    <h1>–û—â—É—â–µ–Ω–∏–µ.</h1>
    <div class="option" onclick="pick(2,'–ú—è–≥–∫–æ')">–ú—è–≥–∫–æ</div>
    <div class="option" onclick="pick(2,'–ü–ª–æ—Ç–Ω–æ')">–ü–ª–æ—Ç–Ω–æ</div>
  </div>

  <div class="screen" id="q3">
    <h1>–ü–∞—É–∑–∞.</h1>
    <div class="option" onclick="pick(3,'–û—Ä–µ—Ö')">–û—Ä–µ—Ö</div>
    <div class="option" onclick="pick(3,'–•–ª–µ–±')">–•–ª–µ–±</div>
  </div>

  <div class="screen" id="q4">
    <h1>–°–∫–æ—Ä–æ—Å—Ç—å.</h1>
    <div class="option" onclick="pick(4,'–†–æ–≤–Ω–æ')">–†–æ–≤–Ω–æ</div>
    <div class="option" onclick="pick(4,'–ú–µ–¥–ª–µ–Ω–Ω–æ')">–ú–µ–¥–ª–µ–Ω–Ω–æ</div>
  </div>

  <div class="screen" id="q5">
    <h1>–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ.</h1>
    <div class="option" onclick="pick(5,'–ü–æ–ª—É–º—Ä–∞–∫')">–ü–æ–ª—É–º—Ä–∞–∫</div>
    <div class="option" onclick="pick(5,'–¢–µ–Ω—å')">–¢–µ–Ω—å</div>
  </div>

  <div class="screen" id="q6">
    <h1>–ú–æ–º–µ–Ω—Ç.</h1>
    <div class="option" onclick="pick(6,'–ù–∞—á–∞–ª–æ')">–ù–∞—á–∞–ª–æ</div>
    <div class="option" onclick="pick(6,'–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ')">–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ</div>
  </div>

  <!-- –û–ñ–ò–î–ê–ù–ò–ï -->
  <div class="screen" id="waiting">
    <h1>–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç.</h1>
    <div class="timer" id="timer">25:00</div>
    <p class="small" id="hint"></p>
  </div>

  <!-- –ú–ê–°–¢–ï–† -->
  <div class="screen" id="master">
    <h1>–ó–∞–∫–∞–∑—ã</h1>
    <div id="orders"></div>
    <button class="btn" onclick="refreshOrders()">–û–±–Ω–æ–≤–∏—Ç—å</button>
  </div>

</div>

<script>
/* ==== –ù–ê–°–¢–†–û–ô–ö–ò ==== */
const MASTER_ID = 1292778768;
const BACKEND = "https://hookah-mix-bot-56x5.onrender.com";
const DURATION = 25 * 60 * 1000;

/* ==== TELEGRAM ==== */
const tg = window.Telegram?.WebApp;
const user = tg?.initDataUnsafe?.user;
const isMaster = user && user.id === MASTER_ID;

/* ==== –°–û–°–¢–û–Ø–ù–ò–ï ==== */
let answers = {};
let startTime = null;
let timerInt = null;

/* ==== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==== */
function go(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id)?.classList.add("active");
  tg?.expand();
}

/* ==== –°–ë–†–û–° –ì–û–°–¢–Ø ==== */
function resetGuestState(){
  answers = {};
  startTime = null;
  if (timerInt) clearInterval(timerInt);
}

/* ==== –û–¢–í–ï–¢ ==== */
function pick(step,value){
  answers[step]=value;
  if(step<6) go("q"+(step+1));
  else placeOrder();
}

/* ==== –ó–ê–ö–ê–ó ==== */
async function placeOrder(){
  startTime = Date.now();
  go("waiting");
  startTimer();

  const order = {
    id: startTime,
    start: startTime,
    guest: {
      name: user?.first_name || "–ì–æ—Å—Ç—å",
      username: user?.username || null
    },
    answers
  };

  try{
    await fetch(BACKEND+"/order",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(order)
    });
    document.getElementById("hint").textContent="–ü—Ä–∏–Ω—è—Ç–æ.";
  }catch{
    document.getElementById("hint").textContent="–°–≤—è–∑—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.";
  }
}

/* ==== –¢–ê–ô–ú–ï–† ==== */
function startTimer(){
  const el=document.getElementById("timer");
  timerInt=setInterval(()=>{
    const d=startTime+DURATION-Date.now();
    if(d<=0){el.textContent="–ì–æ—Ç–æ–≤–æ";return;}
    const m=Math.floor(d/60000);
    const s=Math.floor(d%60000/1000);
    el.textContent=`${m}:${String(s).padStart(2,"0")}`;
  },1000);
}

/* ==== –ú–ê–°–¢–ï–† ==== */
async function refreshOrders(){
  const r=await fetch(BACKEND+"/orders");
  const j=await r.json();
  const box=document.getElementById("orders");
  box.innerHTML="";
  j.orders.forEach(o=>{
    box.innerHTML+=`
      <div class="order">
        <b>${o.guest.name}</b><br>
        ${Object.values(o.answers).join(" ¬∑ ")}
      </div>`;
  });
}

/* ==== –°–¢–ê–†–¢ ==== */
window.onload=()=>{
  if(isMaster){
    go("master");
    refreshOrders();
  }else{
    resetGuestState();
    go("s0");
  }
};

/* ==== –í–ê–ñ–ù–û: –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Å–≤–µ—Ä–Ω—É—Ç–æ–≥–æ ==== */
tg?.onEvent("viewportChanged",()=>{
  if(!isMaster){
    const active=document.querySelector(".screen.active");
    if(!active){
      resetGuestState();
      go("s0");
    }
  }
});
</script>
</body>
</html>
